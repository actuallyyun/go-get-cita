![bot](https://media.giphy.com/media/urvsFBDfR6N32/giphy.gif)


# What it does
It helps you to get an appointment when it is difficult to get one. 

I came up with this solution while trying to get an appointment with the Spanish immigration website, cita previa while I lived in Spain. Anyone who moved there perhaps experienced the frustration of getting an appoitment at some point.   

This little cita bot can work with any appointment websites that require you to fill up information in multiple steps before showing you the appoitment avaliability. You will just have to change the URL of the web page. I will explain it in detail in the instruction section.

# How it works

It uses `Selenium` and `Python` and consists the following steps:

1. Use `Selenium` to record the process,and export the code as a `.py`file. This will work as a draft code. 
2. Based on the generated code, you will have to manually make some modifications. Not many, but you will likely have to. Unfortunatelly, the code generated by Selenium is often not perfect. 

# Prerequisites

Please make sure you have the following tools installed at your local machine:
- [ ] Python 3 and higher
- [ ] Pip
- [ ] Chrome(latest)
- [ ] Git
- [ ] Selenium
- [ ] ChromeDriver

To install Selenium and ChromeDriver, run the following command:

``` 
pip install chromedriver-py selenium

```

# Getting Started

1. Clone this repo to your local machine. 
   First init a new git repo. 

   ```
   git clone https://github.com/actuallyyun/go-get-cita-previa main
   ```
2. Install dependencies: `pip install requirements.txt`
3. Open the ```test_demo.py``` file, this was generated by selenium IDE and modified by me. You can find my modifications by locating the comments.
4. Install the Chrome extension ```Selenium IDE```.
5. Start Selenium IDE, follow the instructions to generate your appoitment data. Export the file and save it in `/GoGetCita`directory so the  `getcita.py` file can access it.
6. Let's modify the auto generated file. Add this to the end of the file:
```

        # If no cita, driver quits and starts again
        if "En este momento no hay citas disponibles." in self.driver.page_source:

            self.driver.find_element(By.ID, "btnSubmit").click()
            self.driver.close()

        # If there is cita, driver waits
        else:
            time.sleep(6000)
```
Often when you have to scroll down a page to see the button, Selenium fails to record this behaviour. So add this when it's needed:
```
# Sometimes you have to tell it to scroll more, feel free to add another line
        self.driver.execute_script(
            "window.scrollTo(0,document.body.scrollHeight);")
```
> If you have to select a date, it's better to type it then click on the select menu for selenium to record it.
> 
6. Make sure the ```test_demo.py``` file name is consistent in the ```getcita.py``` file, as well the function called.
7. In your terminal, run ```python getcita.py``` to start the script.

# Troubleshooting
1. It took me a couple of tries modifying the auto generated code to make it work properly. Often the problem is the scroll down action.
2. The first time I tried to run ChromeDriver, my local machine(Mac OS) blocked it. So make sure to unblock it. 
3. That's about it. Feel free to comment and commit. And good luck with your appointment!  
